server {
  bind_address = "0.0.0.0"
  bind_port = "8081"

  trust_domain = "example.org"

  data_dir = "/run/spire/server"
  log_level = "INFO"

  # Keep X.509 SVIDs short-lived.
  default_x509_svid_ttl = "10m"
}

plugins {
  DataStore "sql" {
    plugin_data {
      database_type = "sqlite3"
      connection_string = "/run/spire/server/datastore.sqlite3"
    }
  }

  # Kubernetes Node attestation (SPIRE Agent -> SPIRE Server).
  # In Kubernetes, this is commonly k8s_sat (service account token attestation).
  NodeAttestor "k8s_sat" {
    plugin_data {
      clusters = {
        "k8s" = {
          # Typically the SPIRE Server ServiceAccount/namespace.
          service_account_allow_list = ["spire-system:spire-agent"]
        }
      }
    }
  }

  # Kubernetes Workload attestation (workload selectors like k8s:ns and k8s:sa).
  WorkloadAttestor "k8s" {
    plugin_data {
      # If SPIRE Server runs in-cluster, it can use the in-cluster config.
      # kube_config_file is optional here; set it only for out-of-cluster server.
    }
  }

  KeyManager "disk" {
    plugin_data {
      directory = "/run/spire/server/keys"
    }
  }

  UpstreamAuthority "disk" {
    plugin_data {
      # For production, consider an external CA / HSM-backed authority.
      cert_file_path = "/run/spire/server/ca.crt"
      key_file_path  = "/run/spire/server/ca.key"
    }
  }
}
