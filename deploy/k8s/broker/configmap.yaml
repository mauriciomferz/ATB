apiVersion: v1
kind: ConfigMap
metadata:
  name: atb-broker-config
  namespace: atb
  labels:
    app.kubernetes.io/name: broker
    app.kubernetes.io/part-of: agent-trust-broker
data:
  config.yaml: |
    # ATB Broker Configuration
    server:
      http_port: 8080
      https_port: 8443
      read_timeout: 30s
      write_timeout: 30s
      shutdown_timeout: 10s

    opa:
      url: http://atb-opa:8181
      policy_path: /v1/data/poa/authorize
      timeout: 5s

    upstream:
      timeout: 30s
      max_idle_conns: 100
      idle_conn_timeout: 90s

    tls:
      enabled: true
      cert_file: /certs/tls.crt
      key_file: /certs/tls.key
      ca_file: /certs/ca.crt
      client_auth: require

    logging:
      level: info
      format: json
      
    metrics:
      enabled: true
      path: /metrics
      port: 9090

  connectors.json: |
    {
      "connectors": [
        {
          "id": "default",
          "upstream_url": "http://upstream-service:8080",
          "allowed_actions": ["*"],
          "timeout_seconds": 30
        }
      ]
    }
